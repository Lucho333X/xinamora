<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>XINA MORA | LA SEÑAL | MASTER V10</title>
    
    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700;800&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --bg-color: #050505;
            --text-color: #f0f0f0;
            --accent-color: #FF0000; /* CAMBIO: Rojo Potente (Pure Red) */
            --secondary-accent: #33ff33;
            --grid-line: #222;
            --font-head: 'Space Grotesk', sans-serif;
            --font-mono: 'Space Mono', monospace;
            --cursor-size: 20px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; cursor: none; }

        /* Ajuste para móvil para evitar selección de texto al jugar */
        canvas { touch-action: none; user-select: none; -webkit-user-select: none; }

        html { scroll-behavior: smooth; }

        body {
            background-color: var(--bg-color); color: var(--text-color);
            font-family: var(--font-head); overflow-x: hidden; text-transform: uppercase;
        }

        /* --- CUSTOM CURSOR --- */
        #cursor {
            position: fixed; top: 0; left: 0; width: var(--cursor-size); height: var(--cursor-size);
            border: 2px solid var(--accent-color); transform: translate(-50%, -50%) rotate(45deg);
            pointer-events: none; z-index: 9999; transition: width 0.1s, height 0.1s;
            mix-blend-mode: difference;
        }
        #cursor.active { background: var(--accent-color); width: 10px; height: 10px; }
        
        /* Ocultar cursor custom en movil */
        @media (hover: none) and (pointer: coarse) {
            #cursor { display: none; }
            * { cursor: auto !important; }
        }
        
        /* --- BACKGROUND FX --- */
        .noise-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAUVBMVEWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYV/hXchAAAAHXRSTlMA+++++++++g+++++++O++++++f++++++U+++++f62T+fAAAAHlJREFUeNrtwQEBAAAAgqD+r2zHBxQAAAAAAAAAAAAAAIB3BuG1AAG35GzgAAAAAElFTkSuQmCC') repeat;
            opacity: 0.05; z-index: 900;
        }

        /* --- TICKER --- */
        .ticker-wrap {
            width: 100%; overflow: hidden; background-color: var(--accent-color);
            color: #000; border-bottom: 1px solid var(--grid-line);
        }
        .ticker {
            display: inline-block; white-space: nowrap; padding: 10px 0;
            animation: ticker 15s linear infinite; font-family: var(--font-mono);
            font-weight: 700; font-size: 1.2rem;
        }
        .ticker__item { padding: 0 2rem; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* --- HEADER --- */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px 40px; border-bottom: 1px solid var(--grid-line);
            position: sticky; top: 0; background: rgba(5, 5, 5, 0.95);
            backdrop-filter: blur(5px); z-index: 100;
        }
        .logo-container img { 
            height: 40px; 
            width: auto; 
            display: block;
        }
        .nav-links { display: flex; gap: 40px; font-family: var(--font-mono); font-size: 0.85rem; }
        .nav-links li { transition: 0.2s; }
        .nav-links li:hover { color: var(--accent-color); text-shadow: 2px 0 var(--secondary-accent); }

        /* --- CONTROLS --- */
        .controls-panel {
            position: fixed; bottom: 30px; right: 30px; z-index: 800;
            display: flex; flex-direction: column; gap: 10px; align-items: flex-end;
        }
        .control-btn {
            background: rgba(0,0,0,0.9); border: 1px solid #333; color: #fff;
            padding: 10px 15px; font-family: var(--font-mono); font-size: 0.8rem;
            transition: 0.2s; display: flex; align-items: center; gap: 10px;
        }
        .control-btn:hover { border-color: var(--accent-color); color: var(--accent-color); }
        .audio-group { display: flex; gap: 5px; background: #000; padding: 5px; border: 1px solid #333; }
        .active-music { background-color: var(--accent-color) !important; color: #000 !important; border-color: var(--accent-color) !important; }

        /* --- HERO --- */
        .hero { padding: 80px 40px; border-bottom: 1px solid var(--grid-line); position: relative; }
        .hero h1 {
            font-size: clamp(3rem, 8vw, 8rem); line-height: 0.85; font-weight: 800;
            letter-spacing: -3px; margin-bottom: 30px;
        }
        .glitch-text { display: inline-block; transition: 0.3s; }
        .hero:hover .glitch-text { color: var(--accent-color); transform: skewX(-10deg); }

        .cta-btn {
            padding: 15px 40px; background: transparent; border: 2px solid var(--text-color);
            color: var(--text-color); font-family: var(--font-mono); font-weight: 700;
            font-size: 1rem; position: relative; overflow: hidden; transition: 0.3s; margin-top: 20px;
        }
        .cta-btn::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: var(--accent-color); transition: 0.4s; z-index: -1;
        }
        .cta-btn:hover::before { left: 0; }
        .cta-btn:hover { border-color: var(--accent-color); color: black; box-shadow: 0 0 20px var(--accent-color); }
        .cta-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* --- EVENTS --- */
        .events-container { border-bottom: 1px solid var(--grid-line); scroll-margin-top: 80px; }
        .filter-bar {
            display: flex; gap: 20px; padding: 20px 40px; border-bottom: 1px solid var(--grid-line);
            font-family: var(--font-mono); font-size: 0.9rem; overflow-x: auto; position: sticky; top: 80px; background: var(--bg-color); z-index: 90;
        }
        .filter-btn { opacity: 0.5; transition: 0.3s; cursor: none; }
        .filter-btn.active, .filter-btn:hover { opacity: 1; color: var(--accent-color); text-decoration: underline; }

        .event-row {
            display: grid; grid-template-columns: 1fr 3fr 1fr; padding: 25px 40px;
            border-bottom: 1px solid #1a1a1a; align-items: center; transition: 0.2s;
            scroll-margin-top: 140px; 
        }
        .event-row:hover { background: var(--text-color); color: var(--bg-color); }
        .event-row:hover .date { color: var(--bg-color); }
        .date { font-family: var(--font-mono); color: var(--accent-color); font-weight: 700; font-size: 1.5rem; }
        .ticket-tag { border: 1px solid currentColor; padding: 5px 15px; font-family: var(--font-mono); font-size: 0.8rem; }

        /* --- BIG LOGO SECTION --- */
        .big-logo-section {
            padding: 60px 0; 
            border-bottom: 1px solid var(--grid-line);
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }
        .big-logo-section a {
            display: block; 
            width: 100%;
            text-align: center;
        }
        .big-logo-section img {
            max-width: 100%; 
            width: 900px; 
            height: auto;
            filter: none; 
            transition: 0.3s;
        }
        .big-logo-section img:hover {
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.1));
            transform: scale(1.01);
        }

        /* --- FOOTER --- */
        footer {
            padding: 80px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: var(--font-mono);
            color: #666;
            font-size: 0.8rem;
            gap: 30px;
            text-align: center;
        }
        .footer-text { display: flex; flex-direction: column; gap: 10px; }
        .social-links { display: flex; gap: 30px; font-size: 1.8rem; }
        .social-links a { color: var(--accent-color); transition: 0.3s; }
        .social-links a:hover { color: #fff; text-shadow: 0 0 15px var(--accent-color); transform: scale(1.1); }

        /* --- MODALS --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.96); z-index: 9998; justify-content: center;
            align-items: center; flex-direction: column;
        }
        
        .newsletter-box {
            border: 2px solid var(--text-color); background: #000; padding: 40px;
            max-width: 500px; width: 90%; text-align: center; position: relative;
            box-shadow: 0 0 30px rgba(255, 51, 51, 0.1);
            pointer-events: auto; 
        }
        .newsletter-input {
            width: 100%; padding: 15px; background: #111; border: 1px solid #333;
            color: white; font-family: var(--font-mono); margin: 20px 0; text-align: center;
        }
        .newsletter-input:focus { border-color: var(--accent-color); outline: none; }

        /* Game UI */
        .game-wrapper {
            position: relative; border: 2px solid var(--accent-color);
            box-shadow: 0 0 50px rgba(255, 51, 51, 0.15);
            max-width: 100%; max-height: 100%;
        }
        canvas { display: block; background: #050505; cursor: crosshair; width: 100%; height: auto; }
        
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        
        .mode-select { 
            pointer-events: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 40px;
            background: rgba(5,5,5,0.98); padding: 60px; border: 1px solid #333;
            backdrop-filter: blur(10px); max-width: 800px; width: 95%;
        }
        .mode-card {
            border: 1px solid #333; padding: 30px; text-align: center; transition: 0.3s;
            cursor: none; position: relative; overflow: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center;
            height: 220px; background: #080808;
        }
        .mode-card:hover {
            background: #111; transform: scale(1.05); border-color: var(--accent-color);
            box-shadow: 0 0 30px rgba(255, 51, 51, 0.2);
        }
        .mode-card h3 { font-size: 1.5rem; margin-bottom: 10px; color: var(--accent-color); }
        .mode-card p { font-family: var(--font-mono); font-size: 0.8rem; color: #aaa; }
        
        .close-modal { position: absolute; top: -40px; right: 0; font-family: var(--font-mono); color: #fff; cursor: none; font-size: 1rem; }
        .close-modal:hover { color: var(--accent-color); }
        
        .in-game-mute {
            position: absolute; top: 20px; right: 20px; pointer-events: auto;
            background: #333; border: 1px solid #555; color: #888;
            padding: 8px 15px; font-family: var(--font-mono); font-size: 0.8rem;
            z-index: 10002; transition: 0.3s;
        }
        .in-game-mute.active {
            background: var(--accent-color); border-color: var(--accent-color); color: #000; font-weight: bold;
        }

        #scoreHud {
            position: absolute; top: 20px; left: 20px; font-family: var(--font-mono);
            color: white; font-size: 1.2rem; display: none; text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        #mobileControlsHint {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            font-family: var(--font-mono); color: rgba(255,255,255,0.5); font-size: 0.7rem;
            pointer-events: none; display: none;
        }

        @media(max-width: 768px) {
            .mode-select { grid-template-columns: 1fr; padding: 20px; }
            .hero h1 { font-size: 3.5rem; }
            .nav-links { display: none; }
            .controls-panel { bottom: 10px; right: 10px; }
            .game-wrapper canvas { width: 100%; height: auto; }
            
            /* Ajustes Móvil */
            .mode-card { height: 180px; }
            #mobileControlsHint { display: block; }
        }
    </style>
</head>
<body>

    <div id="cursor"></div>
    <div class="noise-overlay"></div>

    <!-- CONTROLES -->
    <div class="controls-panel">
        <div class="audio-group">
            <button class="control-btn hover-target" onclick="toggleMusic()" id="playBtn">
                <i class="fas fa-play"></i>
            </button>
            <button class="control-btn hover-target" onclick="changeTrack()">
                <i class="fas fa-forward"></i>
            </button>
            <div class="control-btn" style="border:none; color:#888;" id="trackDisplay">TRACK 1</div>
        </div>
    </div>

    <!-- MARQUESINA -->
    <div class="ticker-wrap">
        <div class="ticker">
            <span class="ticker__item">LA SEÑAL LLEGA A LATAM</span>
            <span class="ticker__item">COLOMBIA • MÉXICO • ARGENTINA • CHILE</span>
            <span class="ticker__item">/// XINA MORA LIVE</span>
            <span class="ticker__item">INDUSTRIAL TECHNO EXPERIENCE</span>
            <span class="ticker__item">GET YOUR TICKETS NOW</span>
        </div>
    </div>

    <header>
        <div class="logo-container hover-target">
            <!-- LOGO IMAGEN (Requiere subir logo.png) -->
            <img src="logo.png" alt="XINA MORA LOGO" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <!-- Fallback texto por si no hay imagen -->
            <h2 style="font-weight:800; letter-spacing:-1px; display:none;">XINA MORA</h2>
        </div>
        <ul class="nav-links">
            <li class="hover-target" onclick="document.querySelector('.events-container').scrollIntoView({behavior: 'smooth'})">TOUR</li>
            <li class="hover-target" onclick="window.open('https://open.spotify.com/intl-es/artist/4dRPdWRUFyJp0yhjGBLClx', '_blank')">MÚSICA</li>
            <li class="hover-target" onclick="openGame()">JUEGO</li>
            <li class="hover-target" onclick="window.open('https://shop.xinamora.com', '_blank')">MERCH</li>
        </ul>
    </header>

    <section class="hero">
        <h1>
            <span class="glitch-text">LA SEÑAL</span><br>
            LLEGA A <span style="color:var(--accent-color)">LATAM</span>
        </h1>
        <p style="font-family: var(--font-mono); max-width: 500px; margin-bottom: 30px;">
            EL TOUR TECHNO MÁS ESPERADO. RECIBE LA SEÑAL.
        </p>
        <button class="cta-btn hover-target" onclick="openGame()">
            [ INICIAR MISIÓN: JUGAR PARA GANAR ]
        </button>
    </section>

    <section class="events-container">
        <div class="filter-bar">
            <span class="filter-btn active hover-target" onclick="scrollToEvent('all')">TODAS LAS FECHAS</span>
            <span class="filter-btn hover-target" onclick="scrollToEvent('col')">COLOMBIA</span>
            <span class="filter-btn hover-target" onclick="scrollToEvent('mex')">MÉXICO</span>
            <span class="filter-btn hover-target" onclick="scrollToEvent('arg')">ARGENTINA</span>
            <span class="filter-btn hover-target" onclick="scrollToEvent('chi')">CHILE</span>
        </div>

        <div class="event-row hover-target" id="event-col">
            <div class="date">28.11</div>
            <div class="details">
                <h3>BOGOTÁ</h3>
                <p>GATE CLUB // COLOMBIA</p>
            </div>
            <div class="action"><span class="ticket-tag">TICKETS</span></div>
        </div>
        <div class="event-row hover-target" id="event-mex">
            <div class="date">29.11</div>
            <div class="details">
                <h3>CDMX</h3>
                <p>TBA // MÉXICO</p>
            </div>
            <div class="action"><span class="ticket-tag">TICKETS</span></div>
        </div>
        
        <!-- CAMBIO: LINK ACTUALIZADO BUENOS AIRES -->
        <div class="event-row hover-target" id="event-arg" onclick="window.open('https://www.passline.com/eventos/xina-mora-en-argentina-5-de-diciembre', '_blank')" style="cursor: pointer;">
            <div class="date">05.12</div>
            <div class="details">
                <h3>BUENOS AIRES</h3>
                <p>TBA // ARGENTINA</p>
            </div>
            <div class="action"><span class="ticket-tag">TICKETS</span></div>
        </div>

        <div class="event-row hover-target" id="event-chi">
            <div class="date">07.12</div>
            <div class="details">
                <h3>SANTIAGO</h3>
                <p>TBA // CHILE</p>
            </div>
            <div class="action"><span class="ticket-tag">TICKETS</span></div>
        </div>
    </section>

    <!-- SECCIÓN: LOGO GRANDE (100% ANCHO Y CON ENLACE) -->
    <div class="big-logo-section hover-target">
        <a href="https://www.xinamora.com" target="_blank" class="hover-target">
            <img src="logo.png" alt="XINA MORA LARGE LOGO" onerror="this.style.display='none'">
        </a>
    </div>

    <footer>
        <div class="footer-text">
            <span>© 2025 XINA MORA ENTERTAINMENT</span>
            <span>DISEÑADO PARA EL UNDERGROUND</span>
        </div>
        <div class="social-links">
            <a href="https://www.instagram.com/laxinamora/?hl=es" target="_blank" class="hover-target"><i class="fab fa-instagram"></i></a>
            <a href="https://www.tiktok.com/@laxinamora?lang=es" target="_blank" class="hover-target"><i class="fab fa-tiktok"></i></a>
            <a href="https://www.youtube.com/@XinaMora" target="_blank" class="hover-target"><i class="fab fa-youtube"></i></a>
            <a href="https://open.spotify.com/intl-es/artist/4dRPdWRUFyJp0yhjGBLClx" target="_blank" class="hover-target"><i class="fab fa-spotify"></i></a>
        </div>
    </footer>

    <!-- MODAL NEWSLETTER INICIAL -->
    <div id="newsletterModal" class="modal-overlay">
        <div class="newsletter-box">
            <div class="close-modal hover-target" onclick="closeNewsletter()" style="top:10px; right:20px; font-size:1.5rem;">✕</div>
            <h2>RECIBE LA SEÑAL</h2>
            <p style="margin-top:10px; font-family:var(--font-mono); color:#888;">INFO EXCLUSIVA DEL TOUR.</p>
            
            <form id="newsletterForm" action="https://formspree.io/f/mnnrbgwb" method="POST">
                <input type="email" name="_replyto" class="newsletter-input hover-target" placeholder="EMAIL_ADDRESS" required>
                <input type="hidden" name="Subject" value="Suscripción XINA MORA Newsletter">
                <button type="submit" id="newsletterBtn" class="cta-btn hover-target">SUSCRIBIRSE</button>
            </form>
            <p id="newsletterStatus" style="font-family: var(--font-mono); font-size: 0.8rem; color: #fff; margin-top: 10px; min-height: 1.2em;"></p>

        </div>
    </div>

    <!-- MODAL JUEGO -->
    <div id="gameModal" class="modal-overlay">
        
        <div class="game-wrapper">
            <div class="close-modal hover-target" onclick="closeGame()">✕ SALIR</div>
            
            <button class="in-game-mute hover-target" onclick="toggleMusic()" id="inGameMuteBtn">
                <i class="fas fa-volume-mute"></i> MUSIC: OFF
            </button>

            <canvas id="gameCanvas" width="800" height="500"></canvas>
            
            <div id="scoreHud"></div>
            <div id="mobileControlsHint">MÓVIL: TOCA IZQUIERDA PARA MOVER / DERECHA PARA DISPARAR</div>

            <div id="uiLayer" class="ui-layer">
                <!-- Selección -->
                <div id="modeSelect" class="mode-select">
                    <div style="grid-column: span 2; text-align: center; margin-bottom: 10px;">
                        <h2>SELECCIONA TU MISIÓN</h2>
                    </div>
                    
                    <div class="mode-card hover-target" onclick="selectMode('SPACESHIP')">
                        <i class="fas fa-shuttle-space" style="font-size: 3rem; margin-bottom: 20px; color: #fff;"></i>
                        <h3>SPACESHIP HARD TECHNO</h3>
                        <p>CONTROLES: FLECHAS + ESPACIO</p>
                        <div style="color: var(--accent-color);">[ START ]</div>
                    </div>

                    <div class="mode-card hover-target" onclick="selectMode('ZOMBIES')">
                        <i class="fas fa-biohazard" style="font-size: 3rem; margin-bottom: 20px; color: #fff;"></i>
                        <h3>TECHNO ZOMBIES</h3>
                        <p>CONTROLES: RATÓN + CLICK</p>
                        <div style="color: var(--secondary-accent);">[ START ]</div>
                    </div>
                </div>

                <!-- Game Over -->
                <div id="gameOverScreen" class="newsletter-box" style="display:none; border-color:var(--accent-color);">
                    <h2 style="color: var(--accent-color); text-shadow: 0 0 10px red;">HAS MUERTO</h2>
                    <p style="margin: 10px 0; font-family: var(--font-mono);">LA SEÑAL SE HA PERDIDO.</p>
                    <p style="font-size: 0.8rem; color:#666; margin-bottom: 20px;">ENVÍA INFORME DE ERROR PARA SALIR.</p>
                    
                    <form id="exitForm" action="https://formspree.io/f/mnnrbgwb" method="POST">
                        <input type="email" id="exitEmail" name="_replyto" class="newsletter-input hover-target" placeholder="TU_EMAIL" required>
                        <input type="hidden" name="Subject" value="Informe de Error XINA MORA - Juego">
                        <input type="hidden" name="Game_Score" id="hiddenScoreInput">
                        <button type="submit" id="sendExitBtn" class="cta-btn hover-target">ENVIAR LA SEÑAL</button>
                    </form>

                    <p id="exitStatus" style="font-family: var(--font-mono); font-size: 0.8rem; color: var(--secondary-accent); margin-top: 10px; min-height: 1.2em;"></p>
                    
                    <div style="margin-top: 20px;">
                        <span class="hover-target" onclick="showModeSelect()" style="font-size: 0.8rem; text-decoration: underline; cursor: none; color: #fff;">REINTENTAR MISIÓN</span>
                    </div>
                </div>

                <!-- Win Screen -->
                <div id="winScreen" class="newsletter-box" style="display:none; border-color:var(--secondary-accent);">
                    <h2 style="color:var(--secondary-accent);">OBJETIVO CUMPLIDO</h2>
                    <div style="font-size: 2rem; border: 1px dashed var(--secondary-accent); margin: 20px 0; padding: 10px; color: #fff;">CODE: SIGNAL999</div>
                    <button class="cta-btn hover-target" onclick="closeGame()">RECLAMAR</button>
                </div>
            </div>
        </div>
        <div style="margin-top: 15px; font-family: var(--font-mono); color: #666; font-size: 0.8rem;" id="controlsText">
            /// SYSTEM READY
        </div>
    </div>

    <script>
        // Formspree URL para ambos formularios (Newsletter y Game Over)
        const formspreeUrl = 'https://formspree.io/f/mnnrbgwb';

        // --- NAVIGATION LOGIC ---
        function scrollToEvent(id) {
            if(id === 'all') {
                window.scrollTo({top: 0, behavior: 'smooth'});
            } else {
                const el = document.getElementById('event-' + id);
                if(el) el.scrollIntoView({behavior: 'smooth', block: 'center'});
            }
        }

        // --- AUDIO SYNTHESIZER (SFX) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(freq, type, duration, vol = 0.1) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            if(type === 'sawtooth') {
                osc.frequency.exponentialRampToValueAtTime(freq * 0.1, audioCtx.currentTime + duration);
            }
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function sfxShoot() { playTone(800, 'sawtooth', 0.15, 0.1); }
        function sfxExplosion() { playTone(100, 'square', 0.3, 0.2); playTone(50, 'sawtooth', 0.4, 0.2); }
        function sfxZombieHit() { playTone(200, 'square', 0.1, 0.05); }

        // --- MÚSICA ---
        const tracks = [
            { name: "TRACK 1", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" }
        ];
        let audio = new Audio(tracks[0].src);
        audio.volume = 0.6;
        audio.loop = true;

        function updateMusicUI(isPlaying) {
            const mainBtn = document.getElementById('playBtn');
            const gameBtn = document.getElementById('inGameMuteBtn');
            
            if(isPlaying) {
                mainBtn.classList.add('active-music');
                mainBtn.innerHTML = '<i class="fas fa-pause"></i>';
                gameBtn.classList.add('active');
                gameBtn.innerHTML = '<i class="fas fa-volume-up"></i> MUSIC: ON';
            } else {
                mainBtn.classList.remove('active-music');
                mainBtn.innerHTML = '<i class="fas fa-play"></i>';
                gameBtn.classList.remove('active');
                gameBtn.innerHTML = '<i class="fas fa-volume-mute"></i> MUSIC: OFF';
            }
        }

        function toggleMusic() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            if(audio.paused) { audio.play(); updateMusicUI(true); } 
            else { audio.pause(); updateMusicUI(false); }
        }

        function changeTrack() {
            audio.currentTime = 0;
            if(audio.paused) toggleMusic();
        }

        // --- MANEJO DE FORMULARIOS ---
        async function handleExitFormSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const btn = document.getElementById('sendExitBtn');
            const status = document.getElementById('exitStatus');
            document.getElementById('hiddenScoreInput').value = `Score: ${score} - Wave: ${wave}`;
            btn.disabled = true;
            btn.innerText = "CONECTANDO...";
            status.innerHTML = `ENVIANDO INFORME...`;
            status.style.color = "#33ff33";
            try {
                const response = await fetch(form.action, {
                    method: form.method,
                    body: new FormData(form),
                    headers: { 'Accept': 'application/json' }
                });
                if (response.ok) {
                    status.innerHTML = "SEÑAL VERIFICADA: Informe enviado.";
                    setTimeout(() => { closeGame(); form.reset(); status.innerHTML = ""; }, 2000);
                } else {
                    status.innerHTML = "ERROR DE SERVIDOR.";
                    status.style.color = "red";
                }
            } catch (error) {
                status.innerHTML = "ERROR DE CONEXIÓN.";
                status.style.color = "red";
            } finally {
                btn.disabled = false;
                btn.innerText = "ENVIAR LA SEÑAL";
            }
        }

        async function handleNewsletterSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const btn = document.getElementById('newsletterBtn');
            const status = document.getElementById('newsletterStatus');
            btn.disabled = true;
            btn.innerText = "VERIFICANDO...";
            try {
                const response = await fetch(form.action, {
                    method: form.method,
                    body: new FormData(form),
                    headers: { 'Accept': 'application/json' }
                });
                if (response.ok) {
                    status.innerHTML = "¡GRACIAS! Ya estás en la lista.";
                    status.style.color = "#33ff33";
                    setTimeout(() => { closeNewsletter(); form.reset(); status.innerHTML = ""; }, 2000);
                } else {
                    status.innerHTML = "ERROR.";
                    status.style.color = "red";
                }
            } catch (error) {
                status.innerHTML = "ERROR DE CONEXIÓN.";
                status.style.color = "red";
            } finally {
                btn.disabled = false;
                btn.innerText = "SUSCRIBIRSE";
            }
        }

        // --- GENERAL UI ---
        setTimeout(() => { document.getElementById('newsletterModal').style.display = 'flex'; }, 15000);
        function closeNewsletter() { document.getElementById('newsletterModal').style.display = 'none'; }

        const cursor = document.getElementById('cursor');
        document.addEventListener('mousemove', (e) => {
            cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px';
        });
        document.querySelectorAll('.hover-target').forEach(el => {
            el.addEventListener('mouseenter', () => {
                cursor.classList.add('active');
                document.body.style.cursor = 'none';
            });
            el.addEventListener('mouseleave', () => cursor.classList.remove('active'));
        });

        window.addEventListener('load', () => {
            const exitForm = document.getElementById('exitForm');
            const newsletterForm = document.getElementById('newsletterForm');
            if (exitForm) exitForm.addEventListener('submit', handleExitFormSubmit);
            if (newsletterForm) newsletterForm.addEventListener('submit', handleNewsletterSubmit);
        });

        // ==========================================
        // === GAME ENGINE V10 (MOBILE ENHANCED) ===
        // ==========================================
        const modal = document.getElementById('gameModal');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameLoopId;
        let gameActive = false;
        let mode = null;
        let score = 0;
        let wave = 1;
        let shake = 0;
        
        const keys = {};
        const mouse = { x: 400, y: 250, down: false };

        // INPUTS ESCRITORIO
        document.addEventListener('keydown', e => { keys[e.code] = true; if(e.code==='Space'||e.code.startsWith('Arrow')) e.preventDefault(); });
        document.addEventListener('keyup', e => delete keys[e.code]);
        canvas.addEventListener('mousemove', e => {
            const rect = canvas.getBoundingClientRect();
            mouse.x = (e.clientX - rect.left) * (canvas.width / rect.width);
            mouse.y = (e.clientY - rect.top) * (canvas.height / rect.height);
        });
        canvas.addEventListener('mousedown', () => mouse.down = true);
        canvas.addEventListener('mouseup', () => mouse.down = false);

        // --- INPUTS MÓVIL (NUEVO) ---
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const tX = (touch.clientX - rect.left) * (canvas.width / rect.width);
            const tY = (touch.clientY - rect.top) * (canvas.height / rect.height);
            
            mouse.x = tX;
            mouse.y = tY;

            if(mode === 'SPACESHIP') {
                // Mitad derecha dispara, Mitad izquierda mueve (siguiendo Y)
                if(tX > canvas.width / 2) {
                    keys['Space'] = true;
                }
            } else if (mode === 'Zombies') {
                mouse.down = true;
            }
        }, {passive: false});

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const tX = (touch.clientX - rect.left) * (canvas.width / rect.width);
            const tY = (touch.clientY - rect.top) * (canvas.height / rect.height);
            
            mouse.x = tX;
            mouse.y = tY;
        }, {passive: false});

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            keys['Space'] = false;
            mouse.down = false;
        });

        // --- GAME LOGIC ---
        function openGame() {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeGame() {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            gameActive = false;
            cancelAnimationFrame(gameLoopId);
            document.getElementById('uiLayer').style.pointerEvents = 'none';
            document.getElementById('modeSelect').style.display = 'grid';
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('winScreen').style.display = 'none';
            document.getElementById('scoreHud').style.display = 'none';
        }

        function showModeSelect() {
            gameActive = false;
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('modeSelect').style.display = 'grid';
        }

        function selectMode(selected) {
            mode = selected;
            document.getElementById('modeSelect').style.display = 'none';
            document.getElementById('scoreHud').style.display = 'block';
            startGame();
        }

        // Entidades
        let player, entities = [], particles = [];

        function startGame() {
            gameActive = true;
            score = 0;
            wave = 1;
            entities = [];
            particles = [];
            shake = 0;

            if(mode === 'SPACESHIP') {
                player = { x: 50, y: 250, w: 30, h: 20, spd: 5, cd: 0 };
            } else {
                player = { x: 400, y: 250, hp: 100, cd: 0 };
            }
            gameLoop();
        }

        function gameOver() {
            gameActive = false;
            sfxExplosion();
            document.getElementById('uiLayer').style.pointerEvents = 'auto';
            document.getElementById('gameOverScreen').style.display = 'block';
        }

        function spawnParticles(x, y, color, count=5) {
            for(let i=0; i<count; i++) {
                particles.push({
                    x, y, 
                    vx: (Math.random()-0.5)*5, vy: (Math.random()-0.5)*5,
                    life: 1.0, color
                });
            }
        }

        function gameLoop() {
            if(!gameActive) return;

            // Clear & Shake
            ctx.fillStyle = '#050505';
            ctx.save();
            if(shake > 0) {
                ctx.translate(Math.random()*shake - shake/2, Math.random()*shake - shake/2);
                shake *= 0.9;
            }
            ctx.fillRect(0,0, canvas.width, canvas.height);

            // Update Score
            document.getElementById('scoreHud').innerText = `SCORE: ${score}`;

            if(mode === 'SPACESHIP') updateSpaceship();
            else updateZombies();

            // Particles
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.life -= 0.05;
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life;
                ctx.fillRect(p.x, p.y, 2, 2);
                if(p.life <= 0) particles.splice(i, 1);
            });
            ctx.globalAlpha = 1;
            ctx.restore();

            gameLoopId = requestAnimationFrame(gameLoop);
        }

        function updateSpaceship() {
            // Player Logic (Desktop + Mobile via keys injection/mouse Y)
            let moveUp = keys['ArrowUp'];
            let moveDown = keys['ArrowDown'];
            
            // Movimiento táctil: si no hay teclas, la nave sigue al dedo en Y
            if(!moveUp && !moveDown && mouse.y !== 0) {
                if(player.y < mouse.y - 10) player.y += player.spd;
                if(player.y > mouse.y + 10) player.y -= player.spd;
            } else {
                if(moveUp) player.y -= player.spd;
                if(moveDown) player.y += player.spd;
            }

            // Boundaries
            player.y = Math.max(20, Math.min(canvas.height-20, player.y));

            // Draw Ship
            ctx.strokeStyle = 'cyan'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(player.x+20, player.y); 
            ctx.lineTo(player.x-10, player.y-10); ctx.lineTo(player.x-10, player.y+10); 
            ctx.closePath(); ctx.stroke();

            // Shoot
            if(player.cd > 0) player.cd--;
            if(keys['Space'] && player.cd <= 0) {
                entities.push({ type: 'bullet', x: player.x+20, y: player.y, w: 10, h: 4, vx: 10 });
                sfxShoot();
                player.cd = 10;
            }

            // Spawn Enemies
            if(Math.random() < 0.02 + (score/5000)) {
                entities.push({ 
                    type: 'enemy', x: canvas.width, y: Math.random()*(canvas.height-40)+20, 
                    w: 20, h: 20, vx: -(3 + Math.random()*3) 
                });
            }

            // Process Entities
            for(let i = entities.length-1; i>=0; i--) {
                let e = entities[i];
                e.x += e.vx;
                
                if(e.type === 'bullet') {
                    ctx.fillStyle = 'cyan'; ctx.fillRect(e.x, e.y, e.w, e.h);
                    if(e.x > canvas.width) entities.splice(i, 1);
                } else if(e.type === 'enemy') {
                    ctx.strokeStyle = '#ff3333'; ctx.strokeRect(e.x, e.y, e.w, e.h);
                    
                    // Collision Ship
                    if(Math.abs(e.x - player.x) < 20 && Math.abs(e.y - player.y) < 20) {
                        gameOver();
                    }
                    if(e.x < 0) entities.splice(i, 1);
                }

                // Bullet Hit Enemy
                if(e.type === 'bullet') {
                    for(let j=0; j<entities.length; j++) {
                        let t = entities[j];
                        if(t.type === 'enemy' && Math.abs(e.x - t.x) < 20 && Math.abs(e.y - t.y) < 20) {
                            spawnParticles(t.x, t.y, '#ff3333');
                            entities.splice(j, 1);
                            entities.splice(i, 1);
                            score += 100;
                            break;
                        }
                    }
                }
            }
        }

        function updateZombies() {
            // Aim Line
            ctx.strokeStyle = 'rgba(51,255,51,0.3)';
            ctx.beginPath(); ctx.moveTo(player.x, player.y); ctx.lineTo(mouse.x, mouse.y); ctx.stroke();

            // Player
            ctx.fillStyle = '#33ff33'; ctx.fillRect(player.x-5, player.y-5, 10, 10);

            // Shoot
            if(player.cd > 0) player.cd--;
            if((mouse.down || keys['Space']) && player.cd <= 0) {
                let angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
                entities.push({ 
                    type: 'bullet', x: player.x, y: player.y, 
                    vx: Math.cos(angle)*12, vy: Math.sin(angle)*12, life: 50
                });
                sfxShoot();
                player.cd = 8;
                shake = 2;
            }

            // Spawn Zombies
            if(Math.random() < 0.02 + (score/10000)) {
                let side = Math.floor(Math.random()*4);
                let zx, zy;
                if(side==0) { zx=Math.random()*canvas.width; zy=-20; }
                if(side==1) { zx=canvas.width+20; zy=Math.random()*canvas.height; }
                if(side==2) { zx=Math.random()*canvas.width; zy=canvas.height+20; }
                if(side==3) { zx=-20; zy=Math.random()*canvas.height; }
                
                entities.push({ type: 'zombie', x: zx, y: zy, w: 15, spd: 1 + Math.random() });
            }

            // Process
            for(let i = entities.length-1; i>=0; i--) {
                let e = entities[i];
                if(e.type === 'bullet') {
                    e.x += e.vx; e.y += e.vy; e.life--;
                    ctx.fillStyle = '#33ff33'; ctx.fillRect(e.x-2, e.y-2, 4, 4);
                    if(e.life <= 0) entities.splice(i, 1);
                } else if(e.type === 'zombie') {
                    let angle = Math.atan2(player.y - e.y, player.x - e.x);
                    e.x += Math.cos(angle) * e.spd;
                    e.y += Math.sin(angle) * e.spd;
                    
                    ctx.strokeStyle = '#fff'; ctx.strokeRect(e.x-7, e.y-7, 14, 14);

                    if(Math.hypot(player.x-e.x, player.y-e.y) < 15) gameOver();
                }

                // Collisions
                if(e.type === 'bullet') {
                    for(let j=0; j<entities.length; j++) {
                        let t = entities[j];
                        if(t.type === 'zombie' && Math.hypot(e.x-t.x, e.y-t.y) < 15) {
                            spawnParticles(t.x, t.y, '#fff');
                            sfxZombieHit();
                            entities.splice(j, 1);
                            entities.splice(i, 1);
                            score += 50;
                            break;
                        }
                    }
                }
            }
        }
    </script>
</body>
</html>
